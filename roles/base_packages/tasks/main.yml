---
- name: Load package list from file
  set_fact:
    package_list: "{{ lookup('file', 'package-list.txt').splitlines() }}"
    batch_size: 50

- name: Split package list into batches
  set_fact:
    package_batches: "{{ package_list | batch(batch_size) }}"

- name: Install each batch (ignoring missing packages)
  become: true
  shell: |
    echo "Installing batch {{ batch_index + 1 }} of {{ package_batches | length }}"
    DEBIAN_FRONTEND=noninteractive apt-get install -y --ignore-missing {{ item | join(' ') }}
  loop: "{{ package_batches }}"
  loop_control:
    index_var: batch_index
    label: "Batch {{ batch_index + 1 }}"
  register: install_results
  changed_when: false
  # ignore_errors: true  # In case apt-get still fails

- name: Show summary of batch install results
  debug:
    msg: |
      Completed {{ package_batches | length }} batches.
      Please review stdout/stderr of any failed batches if needed.
