- name: Reconcile migrated server
  hosts: migrated
  become: true
  gather_facts: true
  vars_files:
    - ../host_vars/migrated.yml

  tasks:
    - name: Include roles with ignore_errors
      include_role:
        name: "{{ item }}"
      loop:
        - keyboard
        - dns
        - ntp
        - ansible_pull
        - clean
        - hostname
        - cron
        - fail2ban
        - clamav
        - rsyslog
        - motd
        - node_exporter
        - opendkim
        - opendmarc
        - postsrsd
        - spamassassin
        - unattended_upgrades
        - iptables
        - kernel
        - auditd
        - apparmor
        - wayland
        - grub
        - sshd
        - network_manager
        - mysql
        - memcached
        - redis
        - php_fpm
        - postfix
        - apache2
        - certbot
        - services
        - chuckbot
        - rclone
      when: role_to_run is not defined or role_to_run == item
      ignore_errors: true
